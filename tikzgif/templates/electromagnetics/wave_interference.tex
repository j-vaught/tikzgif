%%--- TIKZGIF META ---
%% name: em.wave_interference
%% title: Two-Source Wave Interference
%% description: >
%%   Two coherent sources create an interference pattern.
%%   Sweeping phase difference delta shifts the pattern.
%% author: J.C. Vaught
%% version: 1.0.0
%% domain: electromagnetics
%% tags: [EM, wave, interference, superposition, phase]
%% engine: pdflatex
%% tikz_libraries: [calc]
%% latex_packages: [tikz, amsmath]
%% params:
%%   - name: delta
%%     type: float
%%     default: 0.0
%%     min: 0.0
%%     max: 6.283185
%%     step: 0.20944
%%     sweep: true
%%     description: Phase difference between sources
%%     unit: "rad"
%%   - name: sep
%%     type: float
%%     default: 2.0
%%     min: 0.5
%%     max: 4.0
%%     sweep: false
%%     description: Source separation distance
%%     unit: "cm"
%% fps: 15
%% frames: 30
%% loop: true
%% bounce: false
%%--- END META ---
\documentclass[border=5pt,tikz]{standalone}
\usepackage{tikz}
\usepackage{amsmath}
\usetikzlibrary{calc}

\begin{document}
\begin{tikzpicture}

\pgfmathsetmacro{\deltaPhi}{{{{ delta }}}}
\pgfmathsetmacro{\separation}{{{{ sep }}}}
\pgfmathsetmacro{\halfSep}{\separation / 2}
\pgfmathsetmacro{\waveK}{3.0}

\pgfmathsetmacro{\xA}{-\halfSep}
\pgfmathsetmacro{\xB}{\halfSep}

% Interference pattern (pixelated color map)
\foreach \xi in {-4.0, -3.8, ..., 3.8} {
    \foreach \yi in {-3.0, -2.8, ..., 2.8} {
        \pgfmathsetmacro{\px}{\xi + 0.1}
        \pgfmathsetmacro{\py}{\yi + 0.1}
        \pgfmathsetmacro{\rA}{sqrt((\px - \xA)*(\px - \xA) + \py*\py)}
        \pgfmathsetmacro{\rB}{sqrt((\px - \xB)*(\px - \xB) + \py*\py)}
        \pgfmathsetmacro{\valA}{cos(\waveK * \rA * 180 / 3.14159)}
        \pgfmathsetmacro{\valB}{cos(\waveK * \rB * 180 / 3.14159 + \deltaPhi * 180 / 3.14159)}
        \pgfmathsetmacro{\amp}{\valA + \valB}
        \pgfmathsetmacro{\intensity}{(\amp * \amp) / 4.0}
        \pgfmathsetmacro{\colorVal}{100 * \intensity}
        \fill[blue!\colorVal!black] (\xi, \yi) rectangle +(0.2, 0.2);
    }
}

% Source markers
\filldraw[white] (\xA, 0) circle (3pt);
\filldraw[white] (\xB, 0) circle (3pt);
\node[below=3mm, font=\tiny, white] at (\xA, 0) {$S_1$};
\node[below=3mm, font=\tiny, white] at (\xB, 0) {$S_2$};

% Faint wavefronts
\foreach \r in {0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0} {
    \draw[white, opacity=0.15, thin] (\xA, 0) circle (\r);
    \draw[white, opacity=0.15, thin] (\xB, 0) circle (\r);
}

% Title
\node[anchor=north west, font=\footnotesize, fill=black!70, text=white, inner sep=3pt]
    at (-4, 3)
    {$\Delta\phi = \pgfmathprintnumber[fixed, precision=2]{\deltaPhi}$ rad};

\end{tikzpicture}
\end{document}
