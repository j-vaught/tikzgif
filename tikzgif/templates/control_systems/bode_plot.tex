%%--- TIKZGIF META ---
%% name: control.bode_plot
%% title: Bode Plot Parameter Sweep
%% description: >
%%   Bode magnitude and phase of G(s) = K / (s/p + 1) as K sweeps.
%% author: J.C. Vaught
%% version: 1.0.0
%% domain: control_systems
%% tags: [control, bode, frequency response]
%% engine: pdflatex
%% tikz_libraries: []
%% latex_packages: [tikz, pgfplots, amsmath]
%% params:
%%   - name: K
%%     type: float
%%     default: 1.0
%%     min: 0.1
%%     max: 100.0
%%     step: 3.3
%%     sweep: true
%%     description: DC gain
%%     unit: ""
%%   - name: p
%%     type: float
%%     default: 10.0
%%     min: 1.0
%%     max: 100.0
%%     step: 10.0
%%     sweep: false
%%     description: Pole frequency in rad/s
%%     unit: "rad/s"
%% fps: 10
%% frames: 30
%% loop: true
%% bounce: true
%%--- END META ---
\documentclass[border=5pt]{standalone}
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{amsmath}
\pgfplotsset{compat=1.18}

% USC Brand Colors
\definecolor{garnet}{HTML}{73000A}
\definecolor{rose}{HTML}{CC2E40}
\definecolor{atlantic}{HTML}{466A9F}
\definecolor{congaree}{HTML}{1F414D}
\definecolor{horseshoe}{HTML}{65780B}
\definecolor{grass}{HTML}{CED318}
\definecolor{honeycomb}{HTML}{A49137}
\definecolor{warmgrey}{HTML}{676156}
\definecolor{sandstorm}{HTML}{FFF2E3}

\begin{document}
\begin{tikzpicture}

\pgfmathsetmacro{\K}{{{{ K }}}}
\pgfmathsetmacro{\polef}{{{{ p }}}}
\pgfmathsetmacro{\KdB}{20 * log10(\K)}

% Magnitude
\begin{axis}[
    name=mag, width=10cm, height=4.5cm,
    xmode=log, xmin=0.1, xmax=1000,
    ymin=-60, ymax=60,
    ylabel={$|G(j\omega)|$ (dB)},
    title={Bode Plot:\; $G(s) = \dfrac{\pgfmathprintnumber[fixed,precision=1]{\K}}{s/\pgfmathprintnumber[fixed,precision=0]{\polef}+1}$},
    grid=both, grid style={warmgrey!20}, thick,
    every axis title/.style={font=\small},
    tick label style={font=\tiny},
    label style={font=\footnotesize},
    xticklabels={},
]
    \addplot[domain=0.1:1000, samples=200, atlantic, very thick]
        {\KdB - 20*log10(sqrt(1 + (x/\polef)^2))};
    \addplot[domain=0.1:1000, samples=2, dashed, black!40, thin] {0};
\end{axis}

% Phase
\begin{axis}[
    at=(mag.below south west), anchor=north west,
    width=10cm, height=3.5cm,
    xmode=log, xmin=0.1, xmax=1000,
    ymin=-100, ymax=10,
    xlabel={$\omega$ (rad/s)},
    ylabel={$\angle G(j\omega)$ (deg)},
    grid=both, grid style={warmgrey!20}, thick,
    tick label style={font=\tiny},
    label style={font=\footnotesize},
    ytick={0, -45, -90},
]
    \addplot[domain=0.1:1000, samples=200, garnet, very thick]
        {-atan(x/\polef) * 180 / 3.14159};
    \addplot[domain=0.1:1000, samples=2, dashed, black!30, thin] {-45};
    \addplot[domain=0.1:1000, samples=2, dashed, black!30, thin] {-90};
\end{axis}

\end{tikzpicture}
\end{document}
