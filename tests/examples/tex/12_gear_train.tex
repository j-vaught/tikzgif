% Example 12: Gear Train
% Two meshing gears rotating in opposite directions.
% Parameter: \PARAM (rotation angle of gear 1 in degrees, 0 to 360)
% Range: 0 to 360, recommended 72 frames (5-degree steps)
% Difficulty: intermediate
% Features demonstrated: parameterized drawing, mechanical simulation, rotation
\documentclass[tikz]{standalone}
\usepackage{tikz}
\begin{document}
\begin{tikzpicture}
  \useasboundingbox (-5.5,-4) rectangle (5.5,4);

  \pgfmathsetmacro{\angleA}{\PARAM}

  % Gear parameters
  \pgfmathtruncatemacro{\teethA}{16}
  \pgfmathtruncatemacro{\teethB}{24}
  \pgfmathsetmacro{\moduleVal}{0.2}
  \pgfmathsetmacro{\radiusA}{\teethA * \moduleVal / 2}
  \pgfmathsetmacro{\radiusB}{\teethB * \moduleVal / 2}
  \pgfmathsetmacro{\toothDepth}{0.2}

  % Gear B rotates opposite, scaled by gear ratio
  \pgfmathsetmacro{\angleB}{-\angleA * \teethA / \teethB}
  % Offset for meshing alignment
  \pgfmathsetmacro{\meshOffset}{180 / \teethB}

  % Center positions (touching at pitch circles)
  \pgfmathsetmacro{\distAB}{\radiusA + \radiusB}
  \coordinate (centerA) at ({-\distAB/2}, 0);
  \coordinate (centerB) at ({\distAB/2}, 0);

  % Draw gear macro
  % #1 = center, #2 = radius, #3 = num teeth, #4 = angle, #5 = color
  \newcommand{\drawgear}[5]{
    \begin{scope}[shift={#1}, rotate=#4]
      % Gear body
      \fill[#5!20] (0,0) circle (#2 + \toothDepth/2);
      \draw[#5!70!black, thick] (0,0) circle (#2);

      % Teeth
      \foreach \t in {1,...,#3} {
        \pgfmathsetmacro{\tangle}{360 / #3 * \t}
        \pgfmathsetmacro{\halfTooth}{360 / #3 / 4}
        \pgfmathsetmacro{\innerR}{#2 - \toothDepth/2}
        \pgfmathsetmacro{\outerR}{#2 + \toothDepth/2}
        \draw[#5!70!black, thick, fill=#5!30]
          ({\tangle - \halfTooth}:\innerR) --
          ({\tangle - \halfTooth * 0.6}:\outerR) --
          ({\tangle + \halfTooth * 0.6}:\outerR) --
          ({\tangle + \halfTooth}:\innerR);
      }

      % Hub
      \fill[#5!50] (0,0) circle (0.3);
      \fill[white] (0,0) circle (0.12);
      \draw[#5!70!black, thick] (0,0) circle (0.3);

      % Spoke lines
      \foreach \s in {0,90,180,270} {
        \draw[#5!40, thick] (\s:0.3) -- (\s:{#2 * 0.6});
      }
    \end{scope}
  }

  % Draw gears
  \drawgear{(centerA)}{\radiusA}{\teethA}{\angleA}{red}
  \drawgear{(centerB)}{\radiusB}{\teethB}{\angleB + \meshOffset}{blue}

  % Labels
  \node[below, font=\small] at (centerA) [yshift=-\radiusA cm - 0.6cm]
    {Gear A (\teethA T)};
  \node[below, font=\small] at (centerB) [yshift=-\radiusB cm - 0.6cm]
    {Gear B (\teethB T)};

  % Rotation indicators
  \draw[->, red!70!black, thick] ([shift={(120:{\radiusA + 0.6})}]centerA)
    arc (120:60:{\radiusA + 0.6});
  \draw[->, blue!70!black, thick] ([shift={(60:{\radiusB + 0.6})}]centerB)
    arc (60:120:{\radiusB + 0.6});

  \node[font=\small] at (0, -3.5)
    {$\theta_A = \pgfmathprintnumber[fixed, precision=0]{\angleA}^\circ$
     \quad
     $\theta_B = \pgfmathprintnumber[fixed, precision=0]{\angleB}^\circ$};
\end{tikzpicture}
\end{document}
