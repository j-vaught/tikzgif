% Example 20: Electromagnetic Wave Propagation
% Plane EM wave showing E and B field oscillation in time and space.
% Parameter: \PARAM (temporal phase in radians, range 0.0..6.283185)
% Range: 0.0 to 6.283185, recommended 40 frames
% Difficulty: advanced
% Features demonstrated: EM waves, 3D plotting, field visualization

\documentclass[border=8pt,tikz]{standalone}
\usepackage{tikz}
\usepackage{amsmath}
\usetikzlibrary{arrows.meta, calc}

% USC Brand Colors
\definecolor{garnet}{HTML}{73000A}
\definecolor{rose}{HTML}{CC2E40}
\definecolor{atlantic}{HTML}{466A9F}
\definecolor{congaree}{HTML}{1F414D}
\definecolor{horseshoe}{HTML}{65780B}
\definecolor{grass}{HTML}{CED318}
\definecolor{honeycomb}{HTML}{A49137}
\definecolor{warmgrey}{HTML}{676156}
\definecolor{sandstorm}{HTML}{FFF2E3}

\begin{document}
\begin{tikzpicture}[>=Stealth, every node/.style={font=\small}]

\pgfmathsetmacro{\phase}{\PARAM}
\pgfmathsetmacro{\amp}{1.5}
\pgfmathsetmacro{\wavelen}{4}
\pgfmathsetmacro{\zmax}{9}
\pgfmathsetmacro{\kwave}{360/\wavelen}

% Axes
\draw[->, thick, black!60] (0,0,0) -- (\zmax+0.8, 0, 0) node[right]{$z$};
\draw[->, thick, black!60] (0,0,0) -- (0, \amp+0.8, 0) node[above]{$\mathbf{E}$};
\draw[->, thick, black!60] (0,0,0) -- (0, 0, \amp+0.8) node[below left]{$\mathbf{B}$};

% E-field
\draw[garnet, very thick, samples=100, domain=0:\zmax, variable=\z]
    plot (\z, {\amp * sin(\kwave*\z - \phase*180/3.14159)}, 0);

\foreach \z in {0, 0.5, 1.0, ..., 9.0} {
    \pgfmathsetmacro{\Eval}{\amp * sin(\kwave*\z - \phase*180/3.14159)}
    \pgfmathparse{abs(\Eval) > 0.08 ? 1 : 0}
    \ifnum\pgfmathresult=1
        \draw[->, garnet, thin] (\z, 0, 0) -- (\z, \Eval, 0);
    \fi
}

% B-field
\draw[atlantic, very thick, samples=100, domain=0:\zmax, variable=\z]
    plot (\z, 0, {\amp * sin(\kwave*\z - \phase*180/3.14159)});

\foreach \z in {0, 0.5, 1.0, ..., 9.0} {
    \pgfmathsetmacro{\Bval}{\amp * sin(\kwave*\z - \phase*180/3.14159)}
    \pgfmathparse{abs(\Bval) > 0.08 ? 1 : 0}
    \ifnum\pgfmathresult=1
        \draw[->, atlantic, thin] (\z, 0, 0) -- (\z, 0, \Bval);
    \fi
}

% Propagation arrow
\draw[->, ultra thick, black!80, line width=1.5pt]
    (\zmax*0.45, -\amp-0.5, 0) -- (\zmax*0.65, -\amp-0.5, 0)
    node[midway, below, font=\footnotesize] {$\hat{k}$};

% Wavelength
\draw[<->, black!70, thick]
    (0.5, -\amp-0.15, 0) -- ({0.5 + \wavelen}, -\amp-0.15, 0)
    node[midway, below, font=\footnotesize]{$\lambda$};

% Phase label
\node[anchor=north west, font=\footnotesize, fill=white, inner sep=2pt]
    at (0.1, \amp+0.6, 0)
    {$\omega t = \pgfmathprintnumber[fixed, precision=2]{\phase}$ rad};

\end{tikzpicture}
\end{document}
