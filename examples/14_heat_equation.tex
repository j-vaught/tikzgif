% Example 14: Periodic Heating â€” Thermal Penetration Depth
% Semi-infinite solid with sinusoidal surface temperature.
% BC: T(0,t) = sin(wt), T(inf,t) = 0
% Solution: T(x,t) = exp(-x/d) * sin(wt - x/d), where d = sqrt(2*alpha/w)
% Normalized: T(x',wt) = exp(-x') * sin(wt - x') with x' = x/d
% Parameter: \PARAM (phase angle wt, 0 to 4*pi)
% Range: 0 to 12.566, recommended 60 frames at 30fps
% Difficulty: advanced
% Features demonstrated: traveling damped wave, diverging colormap, penetration depth
\documentclass[tikz]{standalone}
\usepackage{pgfplots}
\usepackage{xcolor}
\pgfplotsset{compat=1.18}

% USC Brand Colors
\definecolor{garnet}{HTML}{73000A}
\definecolor{rose}{HTML}{CC2E40}
\definecolor{atlantic}{HTML}{466A9F}
\definecolor{congaree}{HTML}{1F414D}
\definecolor{horseshoe}{HTML}{65780B}
\definecolor{grass}{HTML}{CED318}
\definecolor{honeycomb}{HTML}{A49137}
\definecolor{warmgrey}{HTML}{676156}
\definecolor{sandstorm}{HTML}{FFF2E3}

\begin{document}
\begin{tikzpicture}
  \useasboundingbox (-8bp, -16bp) rectangle (310bp, 230bp);
  \pgfmathsetmacro{\wt}{\PARAM}  % phase angle wt

  % --- Top Panel: Temperature Profile T(x) ---
  \begin{axis}[
    name=topplot,
    at={(0.4cm,1.9cm)},
    width=10cm, height=5.5cm,
    domain=0:5,
    samples=200,
    axis lines=middle,
    xlabel={$x/\delta$},
    ylabel={$T/T_0$},
    ymin=-1.3, ymax=1.3,
    xmin=0, xmax=5,
    xtick={1,2,3,4,5},
    ytick={-1,-0.5,0,0.5,1},
    yticklabel style={/pgf/number format/fixed, /pgf/number format/precision=1},
    grid=major,
    grid style={warmgrey!15},
    title={\small Periodic Heating: $T = e^{-x/\delta}\sin(\omega t - x/\delta)$},
    every axis title/.style={at={(0.5,1.05)}, font=\small},
    clip=true,
  ]
    % Positive fill (honeycomb above zero)
    \addplot[fill=honeycomb!50, draw=none, forget plot]
      {max(0, exp(-x)*sin(\wt*180/3.14159 - x*180/3.14159))} \closedcycle;

    % Negative fill (atlantic below zero)
    \addplot[fill=atlantic!30, draw=none, forget plot]
      {min(0, exp(-x)*sin(\wt*180/3.14159 - x*180/3.14159))} \closedcycle;

    % Envelope: +exp(-x/d)
    \addplot[warmgrey, dashed, thick, forget plot] {exp(-x)};

    % Envelope: -exp(-x/d)
    \addplot[warmgrey, dashed, thick, forget plot] {-exp(-x)};

    % Main temperature profile
    \addplot[garnet, very thick]
      {exp(-x)*sin(\wt*180/3.14159 - x*180/3.14159)};

    % Vertical marker at x' = 1 (one penetration depth)
    \draw[warmgrey, densely dashed, thin]
      (axis cs:1, -1.3) -- (axis cs:1, 1.3);
    \node[above, font=\tiny, warmgrey] at (axis cs:1, 1.15) {$\delta$};

    % Vertical marker at x' = pi (phase inversion depth)
    \draw[warmgrey, densely dashed, thin]
      (axis cs:3.14159, -1.3) -- (axis cs:3.14159, 1.3);
    \node[above, font=\tiny, warmgrey] at (axis cs:3.14159, 1.15) {$\pi\delta$};
  \end{axis}

  % --- Bottom Panel: Color Bar (physical representation) ---
  \pgfmathtruncatemacro{\nrects}{60}
  \pgfmathsetmacro{\barwidth}{8.0}  % match axis plot area width
  \pgfmathsetmacro{\barheight}{1.0}
  \pgfmathsetmacro{\dx}{\barwidth / \nrects}
  \pgfmathsetmacro{\barxoffset}{0.95}  % align with axis plot area

  \foreach \i in {0,...,\numexpr\nrects-1} {
    \pgfmathsetmacro{\xnorm}{(\i + 0.5) / \nrects * 5}  % x' in [0, 5]
    \pgfmathsetmacro{\Tval}{exp(-\xnorm)*sin(\wt*180/3.14159 - \xnorm*180/3.14159)}

    % Diverging colormap: atlantic (cold) <-> white (zero) <-> garnet (hot)
    \pgfmathsetmacro{\absT}{abs(\Tval)}
    \pgfmathtruncatemacro{\cmix}{min(100, max(0, \absT * 100))}

    \pgfmathparse{\Tval >= 0 ? 1 : 0}
    \ifnum\pgfmathresult=1
      \fill[garnet!\cmix!white]
        ({\barxoffset + \i * \dx}, 0) rectangle ({\barxoffset + (\i + 1) * \dx}, \barheight);
    \else
      \fill[atlantic!\cmix!white]
        ({\barxoffset + \i * \dx}, 0) rectangle ({\barxoffset + (\i + 1) * \dx}, \barheight);
    \fi
  }

  % Border for color bar
  \draw[black, thick] (\barxoffset, 0) rectangle ({\barxoffset + \barwidth}, \barheight);

  % Phase label below the color bar
  \node[below, font=\small] at ({\barxoffset + \barwidth/2}, -0.15)
    {$\omega t = \pgfmathprintnumber[fixed, precision=2]{\wt}$};

  % Colorbar legend on the right
  \begin{scope}[shift={({\barxoffset + \barwidth + 0.4}, 0)}]
    \foreach \j in {0,...,20} {
      \pgfmathtruncatemacro{\cval}{\j * 5}
      \pgfmathparse{\j < 10 ? 1 : 0}
      \ifnum\pgfmathresult=1
        % Bottom half: atlantic -> white
        \pgfmathtruncatemacro{\amix}{(10 - \j) * 10}
        \fill[atlantic!\amix!white] (0, {\j * \barheight / 20})
          rectangle (0.35, {(\j + 1) * \barheight / 20});
      \else
        % Top half: white -> garnet
        \pgfmathtruncatemacro{\gmix}{(\j - 10) * 10}
        \fill[garnet!\gmix!white] (0, {\j * \barheight / 20})
          rectangle (0.35, {(\j + 1) * \barheight / 20});
      \fi
    }
    \draw[black, thin] (0, 0) rectangle (0.35, \barheight);
    \node[right, font=\tiny] at (0.4, 0) {$-T_0$};
    \node[right, font=\tiny] at (0.4, \barheight/2) {$0$};
    \node[right, font=\tiny] at (0.4, \barheight) {$+T_0$};
  \end{scope}
\end{tikzpicture}
\end{document}
