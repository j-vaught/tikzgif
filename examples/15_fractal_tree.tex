% Example 15: Fractal Tree Growth
% A recursive tree that grows branch by branch over time.
% Parameter: \PARAM (growth progress, 0 to 1)
% Range: 0 to 1, recommended 60 frames
% Difficulty: advanced
% Features demonstrated: recursive macros, conditional drawing, organic shapes
\documentclass[tikz]{standalone}
\usepackage{tikz}
\usepackage{xcolor}

% USC Brand Colors
\definecolor{garnet}{HTML}{73000A}
\definecolor{rose}{HTML}{CC2E40}
\definecolor{atlantic}{HTML}{466A9F}
\definecolor{congaree}{HTML}{1F414D}
\definecolor{horseshoe}{HTML}{65780B}
\definecolor{grass}{HTML}{CED318}
\definecolor{honeycomb}{HTML}{A49137}
\definecolor{warmgrey}{HTML}{676156}
\definecolor{sandstorm}{HTML}{FFF2E3}

\begin{document}
\begin{tikzpicture}
  \useasboundingbox (-5,-1.5) rectangle (5,8.5);

  \pgfmathsetseed{42}
  \pgfmathsetmacro{\progress}{\PARAM}

  \pgfmathtruncatemacro{\maxdepth}{8}
  \pgfmathsetmacro{\currentdepth}{\progress * \maxdepth}

  % Recursive branch command
  % #1=startX, #2=startY, #3=angle, #4=length, #5=depth, #6=thickness
  \newcommand{\branch}[6]{%
    \pgfmathtruncatemacro{\dep}{#5}%
    \ifnum\dep<\maxdepth
      \pgfmathsetmacro{\branchvisible}{\dep < \currentdepth ? 1 : 0}%
      \ifdim\branchvisible pt>0.5pt
        \pgfmathsetmacro{\growfactor}{min(1, \currentdepth - \dep)}%
        \pgfmathsetmacro{\ex}{#1 + #4 * sin(#3)}%
        \pgfmathsetmacro{\ey}{#2 + #4 * cos(#3)}%
        \pgfmathsetmacro{\ix}{#1 + \growfactor * #4 * sin(#3)}%
        \pgfmathsetmacro{\iy}{#2 + \growfactor * #4 * cos(#3)}%
        %
        % Color: fast transition to green (depth 2+ fully green)
        \pgfmathtruncatemacro{\greenpct}{min(100, max(0, \dep * 50))}%
        \draw[line width=#6 pt, line cap=round, horseshoe!\greenpct!warmgrey]
          (#1, #2) -- (\ix, \iy);%
        %
        % Recurse if fully grown
        \ifdim\growfactor pt>0.99pt
          \pgfmathsetmacro{\newlen}{#4 * 0.7}%
          \pgfmathsetmacro{\newthick}{max(0.2, #6 * 0.65)}%
          \pgfmathtruncatemacro{\newdep}{\dep + 1}%
          % Moderate splay, slightly increasing for canopy spread
          \pgfmathsetmacro{\splay}{18 + \dep * 1.5}%
          \pgfmathsetmacro{\skew}{2 * (-1)^\dep}%
          %
          \pgfmathsetmacro{\angleL}{#3 - \splay + \skew}%
          \begingroup
            \branch{\ex}{\ey}{\angleL}{\newlen}{\newdep}{\newthick}%
          \endgroup
          \pgfmathsetmacro{\angleR}{#3 + \splay + \skew}%
          \branch{\ex}{\ey}{\angleR}{\newlen}{\newdep}{\newthick}%
        \fi
        %
        % Leaf dots at outer depths
        \ifnum\dep>4
          \ifdim\growfactor pt>0.5pt
            \pgfmathsetmacro{\leafsz}{0.04 + 0.005 * \dep}%
            \fill[horseshoe!45!grass, opacity=0.75] (\ix, \iy) circle (\leafsz);%
          \fi
        \fi
      \fi
    \fi
  }

  % Ground
  \fill[horseshoe!30!warmgrey!20] (-5, -0.3) rectangle (5, 0);
  \draw[warmgrey, thick] (-5, 0) -- (5, 0);

  % Short thick trunk
  \pgfmathsetmacro{\trunktop}{0.9}
  \draw[line width=7pt, line cap=round, warmgrey!60!black] (0, 0) -- (0, \trunktop);

  % Three main limbs for a full dome shape:
  % Center limb (tallest, fills the V gap)
  \branch{0}{\trunktop}{0}{1.5}{0}{3.8}
  % Left limb (starts at depth 1 so it has one fewer level = shorter)
  \branch{0}{\trunktop}{-32}{1.1}{1}{2.4}
  % Right limb
  \branch{0}{\trunktop}{32}{1.1}{1}{2.4}

  % Label
  \node[below, font=\small] at (0, -0.8)
    {Growth: $\pgfmathparse{\progress * 100}\pgfmathprintnumber[fixed, precision=0]{\pgfmathresult}\%$};
\end{tikzpicture}
\end{document}
